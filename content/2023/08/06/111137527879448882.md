---
id: 111137527879448882
date: 2023-08-06T06:01:27.076Z
reply: false
media_attachments: 0
---

成功把 https://github.com/emaction/emaction.backend 部署到了自己的 Cloudflare。 原项目没有提供初始化 D1 数据表的命令，通过 Worker.js 逆向出了创建数据表的命令，不完美，最低可用：
    
    
    wrangler d1 execute emaction \
      '--command=CREATE TABLE reactions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        target_id TEXT NOT NULL,
        reaction_name TEXT NOT NULL,
        count INTEGER NOT NULL DEFAULT 0, 
        created_at INTEGER NOT NULL,
        updated_at INTEGER NOT NULL
      )'
    

其他的步骤克隆原项目，`npm install`，然后配置好 wrangler.toml 里的 `database_name` 和 `database_id`，就可以用 `wrangler deploy` 部署到自己的 Cloudflare 里了。前端引入模块不变：
    
    
    <script type="module" src="https://cdn.jsdelivr.net/gh/emaction/frontend.dist@1.0.7/bundle.js"></script>
    

HTML 使用时传值 endpoint，用自己 Cloudflare 提供的域名或绑定的自定义域名：
    
    
    <emoji-reaction class="reactions" reacttargetid="e5n_gts_${id}" theme="system" endpoint="https://api-emaction.eallion.workers.dev"></emoji-reaction>
    

